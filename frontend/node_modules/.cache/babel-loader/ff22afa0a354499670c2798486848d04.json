{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\user\\\\Desktop\\\\m\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\user\\\\Desktop\\\\m\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _objectSpread from\"C:\\\\Users\\\\user\\\\Desktop\\\\m\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\user\\\\Desktop\\\\m\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import Axios from'axios';import React,{useContext,useEffect,useReducer}from'react';import{Helmet}from'react-helmet-async';import{Link,useNavigate}from'react-router-dom';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import Card from'react-bootstrap/Card';import Button from'react-bootstrap/Button';import ListGroup from'react-bootstrap/ListGroup';import{toast}from'react-toastify';import{getError}from'../utils';import{Store}from'../Store';import CheckoutSteps from'../components/CheckoutSteps';import LoadingBox from'../components/LoadingBox';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var reducer=function reducer(state,action){switch(action.type){case'CREATE_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true});case'CREATE_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loading:false});case'CREATE_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false});default:return state;}};export default function PlaceOrderScreen(){var navigate=useNavigate();var _useReducer=useReducer(reducer,{loading:false}),_useReducer2=_slicedToArray(_useReducer,2),loading=_useReducer2[0].loading,dispatch=_useReducer2[1];var _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var cart=state.cart,userInfo=state.userInfo;var round2=function round2(num){return Math.round(num*100+Number.EPSILON)/100;};// 123.2345 => 123.23\ncart.itemsPrice=round2(cart.cartItems.reduce(function(a,c){return a+c.quantity*c.price;},0));cart.shippingPrice=cart.itemsPrice>100?round2(0):round2(10);cart.taxPrice=round2(0.15*cart.itemsPrice);cart.totalPrice=cart.itemsPrice+cart.shippingPrice+cart.taxPrice;var placeOrderHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Axios$post,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch({type:'CREATE_REQUEST'});_context.next=4;return Axios.post('/api/orders',{orderItems:cart.cartItems,shippingAddress:cart.shippingAddress,paymentMethod:cart.paymentMethod,itemsPrice:cart.itemsPrice,shippingPrice:cart.shippingPrice,taxPrice:cart.taxPrice,totalPrice:cart.totalPrice},{headers:{authorization:\"Bearer \".concat(userInfo.token)}});case 4:_yield$Axios$post=_context.sent;data=_yield$Axios$post.data;ctxDispatch({type:'CART_CLEAR'});dispatch({type:'CREATE_SUCCESS'});localStorage.removeItem('cartItems');navigate(\"/order/\".concat(data.order._id));_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);dispatch({type:'CREATE_FAIL'});toast.error(getError(_context.t0));case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function placeOrderHandler(){return _ref.apply(this,arguments);};}();useEffect(function(){if(!cart.paymentMethod){navigate('/payment');}},[cart,navigate]);function MouseOver(event){event.target.style.color='black';}function MouseOut(event){event.target.style.color=\"rgb(135, 122, 122)\";}function changeBackground(e){e.target.style.color='#121212';}function returnBackground(e){e.target.style.color='#494848';}function changeBackground1(e){e.target.style.background='#121212';}function returnBackground1(e){e.target.style.background='black';}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CheckoutSteps,{step1:true,step2:true,step3:true,step4:true}),/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Aper\\xE7u de la commande\"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h1\",{className:\"h1\",children:\"Aper\\xE7u De La Commande\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"f1\",children:\"Livraison\"}),/*#__PURE__*/_jsxs(Card.Text,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Nom:\"}),\" \",cart.shippingAddress.fullName,\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Adresse: \"}),\" \",cart.shippingAddress.address,\",\",cart.shippingAddress.city,\", \",cart.shippingAddress.postalCode,\",\",cart.shippingAddress.country]}),/*#__PURE__*/_jsx(Link,{to:\"/shipping\",className:\"link2\",onMouseOver:MouseOver,onMouseOut:MouseOut,children:\"Modifier\"})]})}),/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"f1\",children:\"Payer\"}),/*#__PURE__*/_jsxs(Card.Text,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"M\\xE9thode:\"}),\" \",cart.paymentMethod]}),/*#__PURE__*/_jsx(Link,{to:\"/payment\",className:\"link2\",onMouseOver:MouseOver,onMouseOut:MouseOut,children:\"Modifier\"})]})}),/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"f1\",children:\"Articles\"}),/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:cart.cartItems.map(function(item){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{className:\"align-items-center\",children:[/*#__PURE__*/_jsxs(Col,{md:6,children:[/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,className:\"img-fluid rounded img-thumbnail\"}),' ',/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.slug),className:\"link1\",onMouseOver:changeBackground,onMouseOut:returnBackground,children:item.name})]}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(\"span\",{className:\"p\",children:item.quantity})}),/*#__PURE__*/_jsxs(Col,{md:3,className:\"p\",children:[item.price,\" DH\"]})]})},item._id);})}),/*#__PURE__*/_jsx(Link,{to:\"/cart\",className:\"link2\",onMouseOver:MouseOver,onMouseOut:MouseOut,children:\"Modifier\"})]})})]}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"f1\",children:\"R\\xE9capitulatif de la commande\"}),/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{className:\"list\",children:\"Articles\"}),/*#__PURE__*/_jsxs(Col,{children:[cart.itemsPrice.toFixed(2),\"DH\"]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{className:\"list\",children:\"Livraison\"}),/*#__PURE__*/_jsxs(Col,{children:[cart.shippingPrice.toFixed(2),\"DH\"]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{className:\"list\",children:\"Taxe\"}),/*#__PURE__*/_jsxs(Col,{children:[cart.taxPrice.toFixed(2),\"DH\"]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"strong\",{children:\" Total De La Commande\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"strong\",{children:[cart.totalPrice.toFixed(2),\"DH\"]})})]})}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{onMouseOver:changeBackground1,onMouseOut:returnBackground1,className:\"btn\",type:\"button\",onClick:placeOrderHandler,disabled:cart.cartItems.length===0,children:\"Passer La commande\"})}),loading&&/*#__PURE__*/_jsx(LoadingBox,{})]})]})]})})})]})]});}","map":{"version":3,"sources":["C:/Users/user/Desktop/m/frontend/src/screens/PlaceOrderScreen.js"],"names":["Axios","React","useContext","useEffect","useReducer","Helmet","Link","useNavigate","Row","Col","Card","Button","ListGroup","toast","getError","Store","CheckoutSteps","LoadingBox","reducer","state","action","type","loading","PlaceOrderScreen","navigate","dispatch","ctxDispatch","cart","userInfo","round2","num","Math","round","Number","EPSILON","itemsPrice","cartItems","reduce","a","c","quantity","price","shippingPrice","taxPrice","totalPrice","placeOrderHandler","post","orderItems","shippingAddress","paymentMethod","headers","authorization","token","data","localStorage","removeItem","order","_id","error","MouseOver","event","target","style","color","MouseOut","changeBackground","e","returnBackground","changeBackground1","background","returnBackground1","fullName","address","city","postalCode","country","map","item","image","name","slug","toFixed","length"],"mappings":"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","sourcesContent":["import Axios from 'axios';\r\nimport React, { useContext, useEffect, useReducer } from 'react';\r\nimport { Helmet } from 'react-helmet-async';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport Row from 'react-bootstrap/Row';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Button from 'react-bootstrap/Button';\r\nimport ListGroup from 'react-bootstrap/ListGroup';\r\nimport { toast } from 'react-toastify';\r\nimport { getError } from '../utils';\r\nimport { Store } from '../Store';\r\nimport CheckoutSteps from '../components/CheckoutSteps';\r\nimport LoadingBox from '../components/LoadingBox';\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'CREATE_REQUEST':\r\n      return { ...state, loading: true };\r\n    case 'CREATE_SUCCESS':\r\n      return { ...state, loading: false };\r\n    case 'CREATE_FAIL':\r\n      return { ...state, loading: false };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default function PlaceOrderScreen() {\r\n  const navigate = useNavigate();\r\n\r\n  const [{ loading }, dispatch] = useReducer(reducer, {\r\n    loading: false,\r\n  });\r\n\r\n  const { state, dispatch: ctxDispatch } = useContext(Store);\r\n  const { cart, userInfo } = state;\r\n\r\n  const round2 = (num) => Math.round(num * 100 + Number.EPSILON) / 100; // 123.2345 => 123.23\r\n  cart.itemsPrice = round2(\r\n    cart.cartItems.reduce((a, c) => a + c.quantity * c.price, 0)\r\n  );\r\n  cart.shippingPrice = cart.itemsPrice > 100 ? round2(0) : round2(10);\r\n  cart.taxPrice = round2(0.15 * cart.itemsPrice);\r\n  cart.totalPrice = cart.itemsPrice + cart.shippingPrice + cart.taxPrice;\r\n\r\n  const placeOrderHandler = async () => {\r\n    try {\r\n      dispatch({ type: 'CREATE_REQUEST' });\r\n\r\n      const { data } = await Axios.post(\r\n        '/api/orders',\r\n        {\r\n          orderItems: cart.cartItems,\r\n          shippingAddress: cart.shippingAddress,\r\n          paymentMethod: cart.paymentMethod,\r\n          itemsPrice: cart.itemsPrice,\r\n          shippingPrice: cart.shippingPrice,\r\n          taxPrice: cart.taxPrice,\r\n          totalPrice: cart.totalPrice,\r\n        },\r\n        {\r\n          headers: {\r\n            authorization: `Bearer ${userInfo.token}`,\r\n          },\r\n        }\r\n      );\r\n      ctxDispatch({ type: 'CART_CLEAR' });\r\n      dispatch({ type: 'CREATE_SUCCESS' });\r\n      localStorage.removeItem('cartItems');\r\n      navigate(`/order/${data.order._id}`);\r\n    } catch (err) {\r\n      dispatch({ type: 'CREATE_FAIL' });\r\n      toast.error(getError(err));\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!cart.paymentMethod) {\r\n      navigate('/payment');\r\n    }\r\n  }, [cart, navigate]);\r\n\r\n  function MouseOver(event) {\r\n    event.target.style.color = 'black';\r\n    \r\n  }\r\n  function MouseOut(event){\r\n    event.target.style.color=\"rgb(135, 122, 122)\";\r\n  }\r\n  function changeBackground(e) {\r\n    e.target.style.color = '#121212';\r\n  }\r\n\r\n  function returnBackground(e) {\r\n    e.target.style.color= '#494848';\r\n  }\r\n\r\n  function changeBackground1(e) {\r\n    e.target.style.background = '#121212';\r\n  }\r\n\r\n  function returnBackground1(e) {\r\n    e.target.style.background = 'black';\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <CheckoutSteps step1 step2 step3 step4></CheckoutSteps>\r\n      <Helmet>\r\n        <title>Aperçu de la commande</title>\r\n      </Helmet>\r\n      <br></br>\r\n      <h1 className='h1'>Aperçu De La Commande</h1>\r\n      <br></br><br></br>\r\n      <Row>\r\n        <Col md={8}>\r\n          <Card className=\"mb-3\">\r\n            <Card.Body>\r\n              <Card.Title className='f1'>Livraison</Card.Title>\r\n              <Card.Text>\r\n                <strong>Nom:</strong> {cart.shippingAddress.fullName} <br />\r\n                <strong>Adresse: </strong> {cart.shippingAddress.address},\r\n                {cart.shippingAddress.city}, {cart.shippingAddress.postalCode},\r\n                {cart.shippingAddress.country}\r\n              </Card.Text>\r\n              <Link to=\"/shipping\" className='link2' onMouseOver={MouseOver} onMouseOut={MouseOut}>Modifier</Link>\r\n            </Card.Body>\r\n          </Card>\r\n\r\n          <Card className=\"mb-3\">\r\n            <Card.Body>\r\n              <Card.Title className='f1'>Payer</Card.Title>\r\n              <Card.Text>\r\n                <strong>Méthode:</strong> {cart.paymentMethod}\r\n              </Card.Text>\r\n              <Link to=\"/payment\" className='link2' onMouseOver={MouseOver} onMouseOut={MouseOut}>Modifier</Link>\r\n            </Card.Body>\r\n          </Card>\r\n\r\n          <Card className=\"mb-3\">\r\n            <Card.Body>\r\n              <Card.Title className='f1'>Articles</Card.Title>\r\n              <ListGroup variant=\"flush\">\r\n                {cart.cartItems.map((item) => (\r\n                  <ListGroup.Item key={item._id}>\r\n                    <Row className=\"align-items-center\">\r\n                      <Col md={6} >\r\n                        <img\r\n                          src={item.image}\r\n                          alt={item.name}\r\n                          className=\"img-fluid rounded img-thumbnail\"\r\n                        ></img>{' '}\r\n                        <Link to={`/product/${item.slug}`} className=\"link1\" onMouseOver={changeBackground} onMouseOut={returnBackground}>{item.name}</Link>\r\n                      </Col>\r\n                      <Col md={3}>\r\n                        <span className='p'>{item.quantity}</span>\r\n                      </Col>\r\n                      <Col md={3} className='p'>{item.price} DH</Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                ))}\r\n              </ListGroup>\r\n              <Link to=\"/cart\" className='link2' onMouseOver={MouseOver} onMouseOut={MouseOut}>Modifier</Link>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        <Col md={4}>\r\n          <Card>\r\n            <Card.Body>\r\n              <Card.Title className='f1'>Récapitulatif de la commande</Card.Title>\r\n              <ListGroup variant=\"flush\">\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col className='list'>Articles</Col>\r\n                    <Col>{cart.itemsPrice.toFixed(2)}DH</Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col className='list'>Livraison</Col>\r\n                    <Col>{cart.shippingPrice.toFixed(2)}DH</Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col className='list'>Taxe</Col>\r\n                    <Col>{cart.taxPrice.toFixed(2)}DH</Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>\r\n                      <strong> Total De La Commande</strong>\r\n                    </Col>\r\n                    <Col>\r\n                      <strong>{cart.totalPrice.toFixed(2)}DH</strong>\r\n                    </Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <div className=\"d-grid\">\r\n                    <Button\r\n                    onMouseOver={changeBackground1} onMouseOut={returnBackground1}\r\n                    className='btn'\r\n                      type=\"button\"\r\n                      onClick={placeOrderHandler}\r\n                      disabled={cart.cartItems.length === 0}\r\n                    >\r\n                      Passer La commande\r\n                    </Button>\r\n                  </div>\r\n                  {loading && <LoadingBox></LoadingBox>}\r\n                </ListGroup.Item>\r\n              </ListGroup>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n    </div>\r\n  );\r\n}"]},"metadata":{},"sourceType":"module"}